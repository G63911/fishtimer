<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Ê∏ØÂºèËí∏È≠öÁéã FishTimer V9.5 | Mobile Ready</title>
    <meta name="description" content="Professional fish steaming timer. Clean light theme with smart memory reset." />
    <link rel="manifest" href="manifest.json" />
    <link rel="apple-touch-icon" href="logo.png" />
    <meta name="theme-color" content="#f8fafc" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@700&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
      :root { --hk-red: #DC2626; }
      body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, "PingFang HK", "Microsoft JhengHei", sans-serif;
        background-color: #f8fafc;
        color: #1e293b;
        min-height: 100vh;
        user-select: none;
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
      }
      .font-mono-timer { font-family: 'JetBrains Mono', monospace; }
      input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.3.1",
    "react-dom/client": "https://esm.sh/react-dom@18.3.1/client"
  }
}
</script>
  </head>
  <body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="module">
      import React, { useState, useEffect, useCallback, useRef } from 'react';
      import ReactDOM from 'react-dom/client';

      // --- Ë≥áÊñôÈÇèËºØ (ÂÆåÂÖ®‰øùÁïô) ---
      const TAELS_PER_CATTY = 16;
      const GRAMS_PER_TAEL = 37.8;
      const FISH_CATEGORIES = [
        { label: 'üëë Áü≥Êñë/Ë≤¥ÂÉπ (Premium Groupers)', fishes: [
          { id: 'red_grouper', name: 'Êù±ÊòüÊñë (Red Grouper)', multiplier: 1.0 },
          { id: 'tiger_grouper', name: 'ËÄÅËôéÊñë (Tiger Grouper)', multiplier: 1.05 },
          { id: 'green_grouper', name: 'ÈùíÊñë (Green Grouper)', multiplier: 1.0 },
          { id: 'pearl_grouper', name: 'ÁèçÁè†Êñë (Pearl Grouper)', multiplier: 1.0 },
          { id: 'mouse_grouper', name: 'ËÄÅÈº†Êñë (Humpback Grouper)', multiplier: 0.95 },
          { id: 'coral_trout', name: 'Ë•øÊòü/ÁáïÊòü (Coral Trout)', multiplier: 1.0 },
        ]},
        { label: 'üåä Â∏∏Ë¶ãÊµ∑È≠ö (Marine Fish)', fishes: [
          { id: 'yellow_croaker', name: 'ÈªÉËä±È≠ö (Yellow Croaker)', multiplier: 0.9 },
          { id: 'pomfret_white', name: 'ÁôΩÈØß (White Pomfret)', multiplier: 0.85 },
          { id: 'pomfret_gold', name: 'ÈáëÈØß (Golden Pomfret)', multiplier: 0.9 },
          { id: 'threadfin', name: 'È¶¨Âèã (Threadfin)', multiplier: 1.0 },
          { id: 'tilefish', name: 'È¶¨È†≠È≠ö (Tilefish)', multiplier: 0.85 },
          { id: 'grey_mullet', name: 'ÁÉèÈ†≠ (Grey Mullet)', multiplier: 1.1 },
          { id: 'seabream', name: 'Á´ãÈ≠ö/ËáòÈ≠ö (Seabream)', multiplier: 1.05 },
          { id: 'snapper', name: 'ÈØõÈ≠ö (Snapper)', multiplier: 1.0 },
        ]},
        { label: 'üèûÔ∏è Ê∑°Ê∞¥/Ê≤≥ÈÆÆ (Freshwater)', fishes: [
          { id: 'grass_carp', name: 'ÈØáÈ≠ö (Grass Carp)', multiplier: 1.1 },
          { id: 'carp_belly', name: 'ÈØáÈ≠öËÖ© (Carp Belly)', multiplier: 1.2 },
          { id: 'mandarin_fish', name: 'Ê°ÇËä±È≠ö (Mandarin Fish)', multiplier: 1.0 },
          { id: 'marble_goby', name: 'Á≠çÊÆºÈ≠ö (Marble Goby)', multiplier: 1.05 },
          { id: 'white_eel', name: 'ÁôΩÈ±î (White Eel)', multiplier: 1.25 },
          { id: 'bighead_carp', name: 'Â§ßÈ≠ö/Â§ßÈ†≠ (Bighead Carp)', multiplier: 1.15 },
        ]},
        { label: 'üî™ ÂÖ∂‰ªñ (Special Cuts)', fishes: [
          { id: 'giant_grouper_meat', name: 'ÈæçË∫âÁêÉ/ËÇâ (Giant Meat)', multiplier: 1.3 },
          { id: 'fish_head', name: 'È≠öÈõ≤/È≠öÈ†≠ (Fish Head)', multiplier: 1.25 },
          { id: 'squid', name: 'ÈÆÆÈ≠∑È≠ö (Fresh Squid)', multiplier: 0.6 },
        ]}
      ];
      const BASE_TIME_SECONDS = 480;
      const SECONDS_PER_TAEL_ADJUSTMENT = 30;
      const RESTING_TIME_SECONDS = 120;

      const translations = {
        zh: { appName: 'Ê∏ØÂºèËí∏È≠öÁéã', appVersion: 'HK Fish King V9.5', fishWeight: 'È≠öÂòÖÈáçÈáè (Êñ§/‰∏°)', catties: 'Êñ§', taels: '‰∏°', grams: 'ÂÖã', fishType: 'È≠öÂòÖÁ®ÆÈ°û', startSteaming: 'ÈñãÁÅ´ÔºÅ', cancelReset: 'ÁÜÑÁÅ´ / ÈáçÁΩÆ', recipe: 'Ëí∏È≠öÂøÖÂãùÊ≥ïÂâá', smartMemoryBadge: 'üî• Â∑≤Ëá™ÂãïÊ†°Ê≠£ÁàêÁÅ´ÁÅ´Âäõ', estimatedTime: 'È†êË®àÈúÄÊôÇ', steaming: 'Ëí∏Á∑ä...', resting: 'ü§´ ÁÜÑÁÅ´ÁÑóÈ≠ö‰∏≠...', stopAlarm: 'ÁÜÑÁÅ´ÔºÅ', dismissAlarm: 'ÊåâÊ≠§ÂÅúÊ≠¢', serveNow: 'È£üÂæóÔºÅ', feedbackTitle: '‰ªäÊ¨°ÊïàÊûúÈªûÔºü', feedbackSubtitle: 'ÊàëÊúÉË®ò‰Ωè‰Ω†ÈÉ®ÁàêÂòÖÁÅ´ÂäõÔºå‰∏ãÊ¨°ÂÜçÊ∫ñÂï≤ÔºÅ', perfect: 'ÂÆåÁæé (Âï±Âï±Â•Ω)', undercooked: 'Êú™ÁÜü (Áîü)', overcooked: 'ËÄÅÂíó (ÈÅéÁÅ´)', shareResult: 'ÂàÜ‰∫´ÊàêÊûú', shareText: (weight, fish) => `üêü ÂÆåÁæéÔºÅÊàëÁî®„ÄêÊ∏ØÂºèËí∏È≠öÁéã„ÄëÊàêÂäüËí∏ÂíóÊ¢ù ${weight} ${fish}ÔºÅÁÅ´ÂÄôÂï±Âï±Â•Ω„ÄÇ‰Ω†ÈÉΩË©¶‰∏ãÔºöhttps://www.fishtimer.com`, rescueButton: 'üöë Ë£úÁÅ´ÊïëÈ≠ö', sauceTitle: 'ÂøÖÂãùË±âÊ≤πÊØî‰æã', soySauce: 'Ëí∏È≠öË±âÊ≤π', sugar: 'ÁôΩÁ≥ñ', hotWater: 'ÁÜüÊ∞¥', oil: 'Ëî•Áµ≤/ÊªæÊ≤π', tbsp: 'ÊπØÂåô', tsp: 'Ëå∂Âåô', adequate: 'ÈÅ©Èáè', recipeTitle: 'Ëí∏È≠öÂøÖÂãùÊ≥ïÂâá', recipeStep1: 'È≠öÂ∫ïÂ¢äËî•ÊÆµÔºåÂ§ßÁÅ´Ê∞¥ÊªæËêΩÈëä„ÄÇ', recipeStep2: 'Ëí∏ÂÆå‰∏ÄÂÆöË¶ÅÂÄíÊéâÁ¢üÂ∫ïËÖ•Ê∞¥ (ÁßòË®£!)„ÄÇ', recipeStep3: 'ËàñËî•Áµ≤ÔºåÊ∑ãÊªæÊ≤πÊøÄÁôºÈ¶ôÂë≥„ÄÇ', recipeStep4: 'ÊúÄÂæåÊ≤øÁ¢üÈÇäÂÄíÂÖ•ÁÜ±Ë±âÊ≤π', chefTip1: 'üí° Â∞àÂÆ∂Êé®‰ªãÔºöÈÖçÂêà', chefTipBold: 'ÂÑ™Ë≥™È†≠ÊäΩ (Premium Soy)', chefTip2: 'Âë≥ÈÅìÊõ¥ÈÆÆ„ÄÇ' },
        ph: { appName: 'Timer ng Isda', appVersion: 'HK Fish King V9.5', fishWeight: 'Timbang ng Isda', catties: 'Êñ§', taels: '‰∏°', grams: 'g', fishType: 'Klase ng Isda', startSteaming: 'Simulan!', cancelReset: 'Kanselahin', recipe: 'Gabay sa Pagluluto', smartMemoryBadge: 'üî• Inayos base sa lakas ng kalan', estimatedTime: 'Oras ng pagluluto', steaming: 'Nagluluto...', resting: 'Hayaan muna (Resting)', stopAlarm: 'PATAYIN APOY!', dismissAlarm: 'PINDUTIN ITO', serveNow: 'Ihain na!', feedbackTitle: 'Kumusta ang luto?', perfect: 'Sakto', undercooked: 'Hilaw', overcooked: 'Sunog', shareResult: 'Ibahagi', shareText: (weight, fish) => `Perfect steamed ${fish} (${weight}) with FishTimer! Try it: https://www.fishtimer.com`, rescueButton: 'üöë Hilaw pa?', sauceTitle: 'Timpla ng Toyo', soySauce: 'Toyo', sugar: 'Asukal', hotWater: 'Mainit na Tubig', oil: 'Mantika/Sibuyas', tbsp: 'tbsp', tsp: 'tsp', adequate: 'Sapat' },
        id: { appName: 'Timer Ikan HK', appVersion: 'HK Fish King V9.5', fishWeight: 'Berat Ikan', catties: 'Êñ§', taels: '‰∏°', grams: 'g', fishType: 'Jenis Ikan', startSteaming: 'Mulai!', cancelReset: 'Batal', recipe: 'Resep Rahasia', smartMemoryBadge: 'üî• Otomatis sesuai kompor Anda', estimatedTime: 'Waktu kukus', steaming: 'Mengukus...', resting: 'Diamkan sebentar', stopAlarm: 'MATIKAN API!', dismissAlarm: 'TEKAN INI', serveNow: 'Siap Saji!', feedbackTitle: 'Hasilnya?', feedbackSubtitle: 'Saya ingat setelan Anda.', undercooked: 'Mentah', perfect: 'Pas', overcooked: 'Kematangan', shareResult: 'Bagikan', shareText: (weight, fish) => `Ikan ${fish} (${weight}) matang sempurna with FishTimer! Coba di: https://www.fishtimer.com`, rescueButton: 'üöë Belum matang?', sauceTitle: 'Saran Kecap', soySauce: 'Kecap Ikan', sugar: 'Gula', hotWater: 'Air Panas', oil: 'Minyak Panas', tbsp: 'sdm', tsp: 'sdt', adequate: 'Secukupnya' }
      };

      const WeightIcon = ({ className }) => React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className: className || "w-8 h-8", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 2.5 }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" }));
      const FishIcon = ({ className }) => React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className: className || "w-8 h-8", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 2.5 }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" }), React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M15 12a3 3 0 11-6 0 3 3 0 016 0z" }));
      const BookOpenIcon = ({ className }) => React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className: className || "w-5 h-5", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 3 }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" }));
      const XIcon = ({ className }) => React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className: className || "w-6 h-6", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 2.5 }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M6 18L18 6M6 6l12 12" }));
      const PlayIcon = ({ className }) => React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className: className || "w-6 h-6", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 3 }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" }), React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M21 12a9 9 0 11-18 0 9 9 0 0118 0z" }));
      const RotateCwIcon = ({ className }) => React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className: className || "w-6 h-6", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 3 }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M4 4v5h5M20 20v-5h-5" }), React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M4 9a9 9 0 0114.13-5.26M20 15a9 9 0 01-14.13 5.26" }));
      const ShareIcon = ({ className }) => React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className: className || "w-5 h-5", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 3 }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" }));
      const AmbulanceIcon = ({ className }) => React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", className: className || "w-5 h-5", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor", strokeWidth: 3 }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M13 10V3L4 14h7v7l9-11h-7z" }));
      const MarketLampIcon = ({ className }) => React.createElement("svg", { className: className || "w-10 h-10", viewBox: "0 0 40 40", fill: "none", xmlns: "http://www.w3.org/2000/svg" }, React.createElement("path", { d: "M20 5V8M20 32V35M10 15L6 11M34 11L30 15", stroke: "currentColor", strokeWidth: "3", strokeLinecap: "round" }), React.createElement("path", { d: "M5 24C5 18 10 12 20 12C30 12 35 18 35 24H5Z", fill: "currentColor" }), React.createElement("path", { d: "M12 24V28C12 30.2091 15.5817 32 20 32C24.4183 32 28 30.2091 28 28V24", stroke: "currentColor", strokeWidth: "3" }));
      const WokIcon = ({ className }) => React.createElement("svg", { className: className || "w-10 h-10", viewBox: "0 0 32 32", fill: "none", xmlns: "http://www.w3.org/2000/svg" }, React.createElement("path", { d: "M4 18C4 22 8 26 16 26C24 26 28 22 28 18", stroke: "currentColor", strokeWidth: "2.5", strokeLinecap: "round" }), React.createElement("path", { d: "M6 16C6 16 10 10 16 10C22 10 26 16 26 16H6Z", fill: "currentColor", opacity: "0.2", stroke: "currentColor", strokeWidth: "2" }), React.createElement("path", { d: "M16 10V6", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round" }), React.createElement("path", { d: "M14 6H18", stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round" }));
      
      // --- UI Components (Sauce Calculator & Recipe - Completely Preserved) ---
      const SauceCalculator = ({ totalTaels, t }) => {
        if (totalTaels <= 0) return null;
        let multiplier = totalTaels > 20 ? 2 : totalTaels > 12 ? 1.5 : 1;
        const fmt = a => { let r = a * multiplier; return r % 1 !== 0 ? `${Math.floor(r)}¬Ω` : r; };
        return React.createElement("div", { className: "space-y-4" },
          React.createElement("h3", { className: "text-lg font-bold uppercase tracking-tight text-slate-500" }, t('sauceTitle')),
          React.createElement("ul", { className: "space-y-2 text-base text-slate-600" },
            React.createElement("li", { className: "flex items-baseline" }, React.createElement("span", { className: "font-bold text-xl mr-2 text-slate-900" }, `${fmt(2)}${t('tbsp')}`), React.createElement("span", null, t('soySauce'))),
            React.createElement("li", { className: "flex items-baseline" }, React.createElement("span", { className: "font-bold text-xl mr-2 text-slate-900" }, `${fmt(1)}${t('tsp')}`), React.createElement("span", null, t('sugar'))),
            React.createElement("li", { className: "flex items-baseline" }, React.createElement("span", { className: "font-bold text-xl mr-2 text-slate-900" }, `${fmt(2)}${t('tbsp')}`), React.createElement("span", null, t('hotWater'))),
            React.createElement("li", { className: "flex items-baseline" }, React.createElement("span", { className: "font-bold text-xl mr-2 text-slate-900" }, t('adequate')), React.createElement("span", null, t('oil')))
          )
        );
      };

      const RecipeModal = ({ isOpen, onClose, t }) => {
        if (!isOpen) return null;
        const recipeSteps = [t('recipeStep1'), t('recipeStep2'), t('recipeStep3'), t('recipeStep4')];
        return React.createElement("div", { className: "fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50", onClick: onClose },
          React.createElement("div", { className: "bg-white rounded-[2rem] shadow-2xl w-full max-w-sm p-8 relative", onClick: e => e.stopPropagation() },
            React.createElement("button", { onClick: onClose, className: "absolute top-4 right-4 text-slate-400 hover:scale-110 transition-transform" }, React.createElement(XIcon, { className: "w-6 h-6" })),
            React.createElement("h2", { className: "text-2xl font-black text-center mb-8 text-slate-900 uppercase tracking-tighter" }, t('recipeTitle')),
            React.createElement("ol", { className: "space-y-6 text-left" },
              recipeSteps.map((step, index) => React.createElement("li", { key: index, className: "flex items-start" },
                React.createElement("span", { className: "mr-3 text-xl font-black text-red-600" }, `${index + 1}.`),
                React.createElement("span", { className: "text-slate-700 font-bold text-base leading-snug" }, step)
              ))
            ),
            React.createElement("div", { className: "mt-8 p-4 bg-red-50 border-l-4 border-red-600 rounded-r-xl" },
              React.createElement("p", { className: "text-sm text-slate-700 font-bold leading-relaxed" }, t('chefTip1'), " ", React.createElement("span", { className: "font-black text-red-600" }, t('chefTipBold')), " ", t('chefTip2'))
            )
          )
        );
      };

      const TimerDisplay = ({ t, timeRemaining, calculatedTime, timerState, onStopAlarmOrFinish, onFeedback, onStartRescue, fishName, weightString }) => {
        const formatTime = seconds => `${String(Math.floor(seconds / 60)).padStart(2, '0')}:${String(seconds % 60).padStart(2, '0')}`;
        if (timerState === 'feedback') {
          return React.createElement("div", { className: "flex flex-col items-center justify-center rounded-[2rem] text-center min-h-[340px] bg-slate-50 p-8 space-y-6 border border-slate-200" },
            React.createElement("div", null,
              React.createElement("h3", { className: "text-2xl font-black text-slate-900 mb-2" }, t('feedbackTitle')),
              React.createElement("p", { className: "text-sm font-bold text-slate-500 px-4" }, t('feedbackSubtitle'))
            ),
            React.createElement("div", { className: "w-full grid grid-cols-1 gap-3" },
              [{ id: 'perfect', color: 'bg-emerald-600 text-white shadow-emerald-900/20' }, { id: 'undercooked', color: 'bg-orange-500 text-white shadow-orange-900/20' }, { id: 'overcooked', color: 'bg-slate-700 text-white shadow-slate-900/20' }].map(btn =>
                React.createElement("button", { key: btn.id, onClick: () => onFeedback(btn.id), className: `py-4 px-4 ${btn.color} rounded-2xl font-extrabold text-sm uppercase tracking-widest active:scale-95 transition-all shadow-md` }, t(btn.id))
              )
            ),
            React.createElement("div", { className: "w-full flex gap-3 pt-2" },
              React.createElement("button", { onClick: onStartRescue, className: "flex-1 flex items-center justify-center py-4 bg-red-600 text-white rounded-2xl font-black text-xs shadow-lg shadow-red-900/30 active:scale-[0.98] transition-all" }, React.createElement(AmbulanceIcon, { className: "w-5 h-5 mr-2" }), React.createElement("span", { className: "uppercase tracking-widest" }, t('rescueButton'))),
              React.createElement("a", { href: `https://wa.me/?text=${encodeURIComponent(t('shareText', weightString, fishName))}`, target: "_blank", rel: "noopener noreferrer", className: "flex-1 flex items-center justify-center py-4 bg-emerald-600 text-white rounded-2xl font-black text-xs shadow-lg shadow-emerald-900/30 active:scale-[0.98] transition-all" }, React.createElement(ShareIcon, { className: "w-5 h-5 mr-2" }), React.createElement("span", { className: "uppercase tracking-widest" }, t('shareResult')))
            )
          );
        }

        const getPhaseConfig = () => {
          switch (timerState) {
            case 'idle': return { status: t('estimatedTime'), ringColor: 'stroke-slate-200', activeRing: 'stroke-slate-300', textColor: 'text-slate-900', progress: 1, displayTime: calculatedTime, icon: null };
            case 'steaming': return { status: t('steaming'), ringColor: 'stroke-red-100', activeRing: 'stroke-red-600', textColor: 'text-red-600', progress: calculatedTime > 0 ? timeRemaining / calculatedTime : 0, displayTime: timeRemaining, icon: 'üî•' };
            case 'resting': return { status: t('resting'), ringColor: 'stroke-orange-100', activeRing: 'stroke-orange-500', textColor: 'text-orange-500', progress: timeRemaining / RESTING_TIME_SECONDS, displayTime: timeRemaining, icon: React.createElement(WokIcon, { className: "w-10 h-10 text-orange-500" }) };
            case 'rescue': return { status: t('rescueing'), ringColor: 'stroke-red-100', activeRing: 'stroke-red-600', textColor: 'text-red-600', progress: timeRemaining / 90, displayTime: timeRemaining, icon: 'üî•' };
            case 'heat_alarm': return { status: t('stopAlarm'), ringColor: 'stroke-red-200', activeRing: 'stroke-red-600', textColor: 'text-red-600', progress: 1, displayTime: timeRemaining, urgent: true, icon: React.createElement(MarketLampIcon, { className: "w-16 h-16 text-red-600" }) };
            case 'ready_alarm': return { status: t('serveNow'), ringColor: 'stroke-emerald-200', activeRing: 'stroke-emerald-500', textColor: 'text-emerald-600', progress: 1, displayTime: 0, urgent: true, icon: 'üòã' };
            default: return { status: '', ringColor: '', activeRing: '', textColor: '', progress: 0, displayTime: 0, icon: null };
          }
        };

        const config = getPhaseConfig();
        const radius = 85; const circumference = 2 * Math.PI * radius;
        const strokeDashoffset = circumference * (1 - Math.max(0, config.progress));

        return React.createElement("div", { className: "relative flex flex-col items-center justify-center py-2 space-y-4 min-h-[340px] transition-all duration-700" },
          config.urgent && React.createElement("div", { onClick: onStopAlarmOrFinish, className: "absolute inset-0 z-30 cursor-pointer rounded-[2rem] bg-red-500/10 animate-pulse active:scale-[0.98] transition-transform" }),
          React.createElement("div", { className: "relative w-64 h-64" },
            React.createElement("svg", { className: "w-full h-full -rotate-90", viewBox: "0 0 200 200" },
              React.createElement("circle", { cx: "100", cy: "100", r: radius, fill: "none", className: config.ringColor, strokeWidth: "12" }),
              React.createElement("circle", { cx: "100", cy: "100", r: radius, fill: "none", className: `transition-all duration-1000 linear ${config.activeRing}`, strokeWidth: "12", strokeDasharray: circumference, strokeDashoffset: strokeDashoffset, strokeLinecap: "butt" })
            ),
            React.createElement("div", { className: "absolute inset-0 flex flex-col items-center justify-center text-center p-4" },
              !config.urgent ?
                React.createElement("div", { className: "flex flex-col items-center justify-center w-full h-full" },
                  React.createElement("div", { className: "mb-1 h-10 flex items-center justify-center" }, config.icon && (typeof config.icon === 'string' ? React.createElement("span", { className: "text-3xl" }, config.icon) : config.icon)),
                  React.createElement("span", { className: `text-6xl font-black font-mono-timer tracking-tighter leading-none ${config.textColor}` }, formatTime(config.displayTime)),
                  React.createElement("p", { className: "w-4/5 mx-auto text-[11px] font-black uppercase tracking-tight text-slate-400 mt-1 break-words leading-tight" }, config.status)
                ) :
                React.createElement("div", { className: "flex flex-col items-center justify-center w-full h-full" },
                  React.createElement("div", { className: "mb-2 transform scale-125" }, config.icon),
                  React.createElement("h4", { className: `text-3xl font-black uppercase tracking-tighter ${timerState === 'heat_alarm' ? 'text-red-600' : 'text-emerald-600'}` }, config.status),
                  React.createElement("div", { className: "mt-1" }, React.createElement("span", { className: "text-[10px] font-black bg-white border border-slate-200 text-slate-900 py-1 px-4 rounded-full shadow-sm" }, t('dismissAlarm')))
                )
            )
          )
        );
      };

      const App = () => {
        const [language, setLanguage] = useState('zh');
        
        // „Äê‰øÆÊ≠£ 1„ÄëÈ†êË®≠ÂÄºÊîπÁÇ∫Á©∫ÁôΩÂ≠ó‰∏≤ ''ÔºåËÆìÁî®Êà∂Ëá™Â∑±Ëº∏ÂÖ•Ôºå‰∏çÈúÄÂà™Èô§
        const [catties, setCatties] = useState(''); 
        const [taels, setTaels] = useState('');
        const [grams, setGrams] = useState(''); // ÂÖã‰πüÈ†êË®≠Á©∫ÁôΩ
        
        const [fishTypeId, setFishTypeId] = useState(FISH_CATEGORIES[0].fishes[0].id);
        const [calculatedTime, setCalculatedTime] = useState(0);
        const [timeRemaining, setTimeRemaining] = useState(0);
        const [timerState, setTimerState] = useState('idle');
        const [userTimeOffset, setUserTimeOffset] = useState(0);
        const [isRecipeModalOpen, setRecipeModalOpen] = useState(false);
        const audioCtxRef = useRef(null);
        const alarmIntervalRef = useRef(null);
        const t = useCallback((key, ...args) => {
            const translationSet = translations[language] || translations.zh;
            const str = translationSet[key] || translations.zh[key];
            return typeof str === 'function' ? str(...args) : str;
        }, [language]);
        useEffect(() => { const saved = localStorage.getItem('userTimeOffset'); if (saved) setUserTimeOffset(parseInt(saved, 10) || 0); }, []);
        
        // „Äê‰øÆÊ≠£ 2„ÄëÊâãÊ©üËÅ≤ÊïàÂº∑ÂäõËß£Èéñ (Mobile Sound Unlock)
        const ensureAudioContext = useCallback(() => {
          if (!audioCtxRef.current) audioCtxRef.current = new (window.AudioContext || window.webkitAudioContext)();
          // 1. Resume context
          if (audioCtxRef.current.state === 'suspended') audioCtxRef.current.resume();
          // 2. Play silent oscillator to force unlock iOS/Android audio engine
          try {
            const osc = audioCtxRef.current.createOscillator();
            const gain = audioCtxRef.current.createGain();
            gain.gain.value = 0; // ÈùúÈü≥
            osc.connect(gain);
            gain.connect(audioCtxRef.current.destination);
            osc.start(0);
            osc.stop(0.001); // Ê•µÁü≠Êí≠Êîæ
          } catch (e) { /* ignore */ }
        }, []);

        // „Äê‰øÆÊ≠£ 3„ÄëËº∏ÂÖ•ËôïÁêÜÔºöÂÖÅË®±Á©∫ÁôΩÔºåË®àÁÆóÊôÇÁï∂‰Ωú 0
        const handleCattyTaelChange = (newCattiesStr, newTaelsStr) => {
            setCatties(newCattiesStr);
            setTaels(newTaelsStr);
            const cVal = newCattiesStr === '' ? 0 : parseInt(newCattiesStr);
            const tVal = newTaelsStr === '' ? 0 : parseInt(newTaelsStr);
            // Âè™Âú®ÊúâÊï∏ÂÄºÊôÇÊõ¥Êñ∞ Grams È°ØÁ§∫
            if (newCattiesStr === '' && newTaelsStr === '') setGrams('');
            else setGrams(parseFloat(((cVal * TAELS_PER_CATTY + tVal) * GRAMS_PER_TAEL).toFixed(1)));
        };
        
        const handleGramsChange = newGramsStr => {
            setGrams(newGramsStr);
            if (newGramsStr === '') { setCatties(''); setTaels(''); return; }
            const gVal = parseFloat(newGramsStr);
            const totalTaels = gVal / GRAMS_PER_TAEL;
            let newCatties = Math.floor(totalTaels / TAELS_PER_CATTY);
            let newTaels = Math.round(totalTaels % TAELS_PER_CATTY); 
            if (newTaels === TAELS_PER_CATTY) { newCatties += 1; newTaels = 0; }
            setCatties(newCatties); setTaels(newTaels);
        };

        useEffect(() => {
            const cVal = catties === '' ? 0 : parseInt(catties);
            const tVal = taels === '' ? 0 : parseInt(taels);
            const totalTaels = cVal * TAELS_PER_CATTY + tVal;
            
            if (totalTaels <= 0) { 
                setCalculatedTime(0); // Ê≤íËº∏ÂÖ•ÊôÇÊôÇÈñìÊ≠∏Èõ∂
                return; 
            }
            const selectedFish = FISH_CATEGORIES.flatMap(c => c.fishes).find(f => f.id === fishTypeId);
            const multiplier = selectedFish ? selectedFish.multiplier : 1.0;
            const baseTime = BASE_TIME_SECONDS + ((totalTaels - TAELS_PER_CATTY) * SECONDS_PER_TAEL_ADJUSTMENT);
            const finalTime = Math.max(0, Math.round(baseTime * multiplier) + userTimeOffset);
            setCalculatedTime(finalTime); 
            if (['idle', 'feedback'].includes(timerState)) setTimeRemaining(finalTime);
        }, [catties, taels, fishTypeId, timerState, userTimeOffset]);
        
        const stopAlarm = useCallback(() => { if (alarmIntervalRef.current) clearInterval(alarmIntervalRef.current); alarmIntervalRef.current = null; }, []);
        
        const playAlarm = useCallback(type => {
            ensureAudioContext(); stopAlarm();
            const play = () => {
                if (!audioCtxRef.current) return; const now = audioCtxRef.current.currentTime;
                if(type === 'urgent') for (let i = 0; i < 4; i++) { const osc = audioCtxRef.current.createOscillator(); osc.type = 'square'; osc.frequency.setValueAtTime(1200, now); osc.connect(audioCtxRef.current.destination); osc.start(now + i * 0.12); osc.stop(now + i * 0.12 + 0.06); } 
                else { const o1 = audioCtxRef.current.createOscillator(); o1.type = 'sine'; o1.frequency.setValueAtTime(1000, now); o1.connect(audioCtxRef.current.destination); o1.start(now); o1.stop(now + 0.15); }
            };
            play(); alarmIntervalRef.current = window.setInterval(play, type === 'urgent' ? 1000 : 1500);
        }, [stopAlarm, ensureAudioContext]);

        useEffect(() => { if (timeRemaining <= 0) {
            if (timerState === 'steaming') { setTimerState('heat_alarm'); setTimeRemaining(RESTING_TIME_SECONDS); } 
            else if (['heat_alarm', 'resting'].includes(timerState)) setTimerState('ready_alarm');
            else if (timerState === 'rescue') setTimerState('feedback');
        }}, [timeRemaining, timerState]);
        useEffect(() => { let id; if (['steaming', 'heat_alarm', 'resting', 'rescue'].includes(timerState)) { id = window.setInterval(() => setTimeRemaining(p => Math.max(0, p - 1)), 1000); } return () => clearInterval(id); }, [timerState]);
        useEffect(() => { if (timerState === 'heat_alarm' || timerState === 'ready_alarm') playAlarm(timerState === 'heat_alarm' ? 'urgent' : 'notify'); else stopAlarm(); return stopAlarm; }, [timerState, playAlarm, stopAlarm]);
        const selectedFish = FISH_CATEGORIES.flatMap(c => c.fishes).find(f => f.id === fishTypeId);
        
        return React.createElement("div", { className: "min-h-screen flex flex-col items-center justify-center p-4" },
          React.createElement("main", { className: "w-full max-w-md bg-white rounded-3xl shadow-xl p-8 md:p-10 space-y-8 border border-slate-200" },
            React.createElement("header", { className: "flex flex-col items-center text-center space-y-4" },
              React.createElement("img", { src: "logo.png", className: "w-24 h-24 mx-auto object-contain", alt: "Logo" }),
              React.createElement("div", { className: "flex p-1 bg-slate-100 rounded-full border border-slate-200" },
                ['zh', 'ph', 'id'].map(l => React.createElement("button", { key: l, onClick: () => setLanguage(l), className: `px-4 py-1.5 text-[10px] font-black rounded-full tracking-widest transition-all ${language === l ? 'bg-white text-slate-900 shadow-md' : 'text-slate-400 hover:text-slate-600'}` }, l === 'zh' ? 'ÁπÅÈ´î' : l.toUpperCase()))
              ),
              React.createElement("div", null,
                React.createElement("h1", { className: "text-3xl font-black tracking-tighter text-slate-900 uppercase" }, t('appName')),
                React.createElement("p", { className: "text-red-600 font-black text-[10px] mt-1 uppercase tracking-[0.3em]" }, t('appVersion'))
              )
            ),
            
            timerState === 'idle' && userTimeOffset !== 0 && React.createElement("div", { 
              onClick: () => { setUserTimeOffset(0); localStorage.removeItem('userTimeOffset'); },
              className: "cursor-pointer bg-red-50 text-red-500 text-[10px] font-black tracking-widest uppercase text-center py-2 px-4 rounded-full border border-red-200 hover:bg-red-100 transition-colors flex items-center justify-center gap-2" 
            }, 
              React.createElement("span", null, `${t('smartMemoryBadge')} (${userTimeOffset > 0 ? '+' : ''}${userTimeOffset}S)`),
              React.createElement(XIcon, { className: "w-3 h-3" }) 
            ),
            
            React.createElement("div", { className: `${timerState !== 'idle' ? 'hidden' : 'space-y-8'}` },
              React.createElement("div", { className: "space-y-6" },
                React.createElement("div", { className: "space-y-3" },
                  React.createElement("label", { className: "flex items-center text-lg font-bold text-slate-900 uppercase" }, React.createElement(WeightIcon, { className: "w-8 h-8 text-slate-700 mr-2" }), t('fishWeight')),
                  React.createElement("div", { className: "grid grid-cols-1 gap-4" },
                    React.createElement("div", { className: "flex bg-white p-1.5 rounded-2xl border border-slate-200 shadow-sm" },
                      React.createElement("div", { className: "relative flex-1" },
                        // „Äê‰øÆÊ≠£ 4„ÄëËº∏ÂÖ•Ê°Ü‰ΩøÁî® placeholder="0" ‰∏¶Âä†ÂÖ• onFocus ÂÖ®ÈÅ∏
                        React.createElement("input", { type: "number", value: catties, onFocus: e => e.target.select(), onChange: e => handleCattyTaelChange(e.target.value, String(taels)), placeholder: "0", className: "w-full py-4 text-center font-black text-3xl text-slate-900 bg-transparent focus:outline-none placeholder-slate-200" }),
                        React.createElement("span", { className: "absolute bottom-1 left-0 right-0 text-[10px] text-center font-black text-slate-400 uppercase" }, t('catties'))
                      ),
                      React.createElement("div", { className: "w-px h-10 bg-slate-200 my-auto" }),
                      React.createElement("div", { className: "relative flex-1" },
                        React.createElement("input", { type: "number", value: taels, onFocus: e => e.target.select(), onChange: e => handleCattyTaelChange(String(catties), e.target.value), placeholder: "0", className: "w-full py-4 text-center font-black text-3xl text-slate-900 bg-transparent focus:outline-none placeholder-slate-200", max: "15" }),
                        React.createElement("span", { className: "absolute bottom-1 left-0 right-0 text-[10px] text-center font-black text-slate-400 uppercase" }, t('taels'))
                      )
                    ),
                    React.createElement("div", { className: "relative bg-slate-50 p-1.5 rounded-2xl border border-slate-200" },
                      React.createElement("input", { type: "number", value: grams, onFocus: e => e.target.select(), onChange: e => handleGramsChange(e.target.value), placeholder: "0", className: "w-full py-4 text-center font-black text-3xl text-slate-900 bg-transparent focus:outline-none placeholder-slate-200" }),
                      React.createElement("span", { className: "absolute bottom-1 left-0 right-0 text-[10px] text-center font-black text-slate-400 uppercase" }, t('grams'))
                    )
                  )
                ),
                // ‰øùÁïôË±âÊ≤πË®àÁÆóÊ©üÔºå‰ΩøÁî®Ë®àÁÆóÂæåÁöÑÊï∏ÂÄº (Á©∫ÁôΩÊôÇÁÇ∫0)
                React.createElement(SauceCalculator, { totalTaels: (catties === '' ? 0 : parseInt(catties)) * TAELS_PER_CATTY + (taels === '' ? 0 : parseInt(taels)), t: t })
              ),
              React.createElement("div", { className: "space-y-3" },
                React.createElement("label", { className: "flex items-center text-lg font-bold text-slate-900 uppercase" }, React.createElement(FishIcon, { className: "w-8 h-8 text-slate-700 mr-2" }), t('fishType')),
                React.createElement("div", { className: "relative" },
                  React.createElement("select", { value: fishTypeId, onChange: e => setFishTypeId(e.target.value), className: "w-full p-4 bg-white border border-slate-200 shadow-sm rounded-2xl font-bold text-slate-900 appearance-none outline-none focus:border-slate-400" },
                    FISH_CATEGORIES.map(category => React.createElement("optgroup", { key: category.label, label: category.label },
                      category.fishes.map(fish => React.createElement("option", { key: fish.id, value: fish.id }, fish.name))
                    ))
                  ),
                  React.createElement("div", { className: "absolute inset-y-0 right-4 flex items-center pointer-events-none text-slate-500" },
                    React.createElement("svg", { className: "w-5 h-5", fill: "none", stroke: "currentColor", viewBox: "0 0 24 24" }, React.createElement("path", { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: "3", d: "M19 9l-7 7-7-7" }))
                  )
                )
              )
            ),
            
            React.createElement(TimerDisplay, { t: t, timeRemaining: timeRemaining, calculatedTime: calculatedTime, timerState: timerState, onStopAlarmOrFinish: () => { if (timerState === 'heat_alarm') setTimerState('resting'); else if (timerState === 'ready_alarm') { setTimerState('feedback'); stopAlarm(); } }, onFeedback: fb => { let offset = userTimeOffset; if (fb === 'undercooked') offset += 30; if (fb === 'overcooked') offset -= 30; setUserTimeOffset(offset); localStorage.setItem('userTimeOffset', String(offset)); setTimerState('idle'); }, onStartRescue: () => { setTimeRemaining(90); setTimerState('rescue'); }, fishName: selectedFish.name, weightString: `${catties}${t('catties')}${taels}${t('taels')}` }),
            
            React.createElement("div", { className: "pt-4" },
              timerState === 'idle' ?
                // „Äê‰øÆÊ≠£ 5„ÄëÈªûÊìäÊåâÈàïÊôÇËß∏Áôº ensureAudioContext (Ëß£ÈéñÊâãÊ©üÈü≥Êïà)
                React.createElement("button", { onClick: () => { ensureAudioContext(); setTimeRemaining(calculatedTime); setTimerState('steaming'); }, className: "w-full flex items-center justify-center py-4 rounded-2xl font-bold text-lg text-white bg-red-600 shadow-lg shadow-red-900/30 uppercase active:scale-[0.98] transition-all" }, React.createElement(PlayIcon, { className: "w-6 h-6 mr-3" }), t('startSteaming')) :
                !['feedback'].includes(timerState) && React.createElement("button", { onClick: () => setTimerState('idle'), className: "w-full flex items-center justify-center py-4 rounded-2xl font-bold text-lg bg-slate-800 text-white uppercase active:scale-[0.98] transition-all" }, React.createElement(RotateCwIcon, { className: "w-6 h-6 mr-3" }), t('cancelReset'))
            ),
            React.createElement("div", { className: "text-center" },
              React.createElement("button", { onClick: () => setRecipeModalOpen(true), className: "inline-flex items-center text-[10px] font-black uppercase tracking-[0.3em] text-slate-400 hover:text-red-500 transition-colors" }, React.createElement(BookOpenIcon, { className: "w-4 h-4 mr-2" }), t('recipe'))
            )
          ),
          React.createElement("footer", { className: "text-center pt-8" },
            React.createElement("p", { className: "text-xs text-slate-500" }, "Designed & Developed by ", React.createElement("a", { href: "http://www.toplinkhk.com", target: "_blank", rel: "noopener noreferrer", className: "font-bold hover:text-red-600 transition-colors" }, "Toplink Hi-Tech Limited"))
          ),
          React.createElement(RecipeModal, { isOpen: isRecipeModalOpen, onClose: () => setRecipeModalOpen(false), t: t })
        );
      };
      const root = ReactDOM.createRoot(document.getElementById('root')); root.render(React.createElement(App, null));
    </script>
  </body>
</html>
